
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OIH Queries &#8212; The Ocean InfoHub Project and the development of the ODIS-architecture</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="OIH Editing Playground" href="OIH_Editor.html" />
    <link rel="prev" title="Indexing Concepts" href="OIH_IndexIntro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">The Ocean InfoHub Project and the development of the ODIS-architecture</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../index.html">
   The Ocean InfoHub Project
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../content.html">
   Structured Data on the Web
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../personas/persona.html">
   Personas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../publishing/publishing.html">
   Publisher
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../foundation/foundation.html">
   JSON-LD Foundation
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Profiles
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../thematics/README.html">
   Thematic Patterns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../thematics/expinst/README.html">
   Core 1: Experts and Institutions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../thematics/docs/README.html">
   Core 2: Documents
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../thematics/docs/maps.html">
   Core 3: Spatial Maps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../thematics/projects/README.html">
   Core 4: Projects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../thematics/training/README.html">
   Core 5: Training
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../thematics/vessels/README.html">
   Core 6: Vessels
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../thematics/spatial/README.html">
   Support 1: Spatial Geometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../thematics/services/README.html">
   Support 2: Services
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../thematics/terms/list.html">
   Support 3: Keywords &amp; Defined Terms
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../thematics/languages/languages.html">
   Support 4: Languages
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../thematics/sdg/index.html">
   Support 5: Linking To Principles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../thematics/identifier/id.html">
   Support 6: Identifier and Prov
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Aggregation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../indexing/index.html">
   Aggregator
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../indexing/qstart.html">
   Indexing with Gleaner
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../indexing/cliDocker/README.html">
   Gleaner CLI Docker
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../indexing/indexingservices.html">
   Indexing Services
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../indexing/dataservices.html">
   Data Services
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../indexing/user.html">
   Interfaces
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../indexing/graphpub.html">
   Graph First Approach
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../indexing/prov/README.html">
   Indexing Activity Prov
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../indexing/alternatives.html">
   Alternatives
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Tooling
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Tooling
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../openRefine/README.html">
     OpenRefine
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../openRefine/template.html">
       Generic Template
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../openRefine/projects.html">
       Sargassum Project Template
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="README.html">
     OIH Notebooks
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="OIH_IndexIntro.html">
       Indexing Concepts
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       OIH Queries
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="OIH_Editor.html">
       OIH Editing Playground
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="OIH_GraphAnalytics.html">
       OIH Graph
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="validation/OIH_Simple_SHACL.html">
       SHACL Simple Validation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="validation/OIH_SHACL.html">
       SHACL Validation on Object Store
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="Mapping/README.html">
       Mapping to Schema.org
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
      <label for="toctree-checkbox-4">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="Mapping/ISO19139mapping/ISOMap.html">
         Mapping - ISO 19139
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Mapping/DCATmapping/dcatmapping.html">
         Mapping - DCAT
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="Exploration/README.html">
       Exploration
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
      <label for="toctree-checkbox-5">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="Exploration/GeoKGComplete/geocomplete.html">
         Geo KG Completion
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Exploration/CA-DWR/CADWR.html">
         California DWR sprint
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Exploration/MarinePrtcAPI.html">
         Marine Protected Areas API exploration
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Exploration/SPREP.html">
         SPREP Data Testing
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Exploration/maspawio.html">
         Maspawio
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Exploration/LDFeed/LDFeed.html">
         Marine Regions LD Feed
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Validation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../validation/README.html">
   Validation
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Interfaces
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../users/referenceclient.html">
   Users
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../users/query.html">
   SPARQL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../users/sparql.html">
   OIH SPARQL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../users/apis.html">
   APIs
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Appendix
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../appendix/index.html">
   Appendix
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../appendix/annoyances.html">
     Known Issues
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../appendix/references.html">
     References
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../appendix/registries.html">
     Registries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../appendix/vocabularies.html">
     Controlled Vocabularies
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/tooling/notebooks/OIH_Queries.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/iodepo/odis-arch"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/iodepo/odis-arch/issues/new?title=Issue%20on%20page%20%2Ftooling/notebooks/OIH_Queries.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/iodepo/odis-arch/master?urlpath=lab/tree/book/tooling/notebooks/OIH_Queries.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/iodepo/odis-arch/blob/master/book/tooling/notebooks/OIH_Queries.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup-and-inits">
   Setup and inits
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imports">
     Imports
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#support-functions">
     Support Functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#queries">
   Queries
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simple-count">
     Simple Count
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simple-org-list">
   Simple org list
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predicate-counts">
     Predicate Counts
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#oih-base-query">
     OIH Base Query
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#oih-gleaner-query">
     OIH Gleaner Query
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#query-for-prov">
   Query for prov
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feed-query">
   Feed query
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#types-breakdown">
   Types Breakdown
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-status-of-spatial-predicates">
   Check status of spatial predicates
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="oih-queries">
<h1>OIH Queries<a class="headerlink" href="#oih-queries" title="Permalink to this headline">¶</a></h1>
<p>What follows are some example SPARQL queries used in OIH for the test interface</p>
<div class="section" id="setup-and-inits">
<h2>Setup and inits<a class="headerlink" href="#setup-and-inits" title="Permalink to this headline">¶</a></h2>
<div class="section" id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">SPARQLWrapper</span> <span class="kn">import</span> <span class="n">SPARQLWrapper</span><span class="p">,</span> <span class="n">JSON</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">dask</span><span class="o">,</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">dask.dataframe</span> <span class="k">as</span> <span class="nn">dd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">geopandas</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">shapely</span>
<span class="c1"># import kglab as kg</span>

<span class="n">oih</span> <span class="o">=</span> <span class="s2">&quot;https://graph.collaborium.io/blazegraph/namespace/oih/sparql&quot;</span>
<span class="n">oihdev</span> <span class="o">=</span> <span class="s2">&quot;https://graph.collaborium.io/blazegraph/namespace/development/sparql&quot;</span>
<span class="n">oihad</span> <span class="o">=</span> <span class="s2">&quot;https://graph.collaborium.io/blazegraph/namespace/aquadocs/sparql&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="support-functions">
<h3>Support Functions<a class="headerlink" href="#support-functions" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title</span>
<span class="k">def</span> <span class="nf">get_sparql_dataframe</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to convert SPARQL results into a Pandas data frame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sparql</span> <span class="o">=</span> <span class="n">SPARQLWrapper</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
    <span class="n">sparql</span><span class="o">.</span><span class="n">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">sparql</span><span class="o">.</span><span class="n">setReturnFormat</span><span class="p">(</span><span class="n">JSON</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">sparql</span><span class="o">.</span><span class="n">query</span><span class="p">()</span>

    <span class="n">processed_results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">response</span><span class="p">)</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">processed_results</span><span class="p">[</span><span class="s1">&#39;head&#39;</span><span class="p">][</span><span class="s1">&#39;vars&#39;</span><span class="p">]</span>

    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">processed_results</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">]:</span>
        <span class="n">item</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="queries">
<h2>Queries<a class="headerlink" href="#queries" title="Permalink to this headline">¶</a></h2>
<p>What follows is a set of queries designed to provide a feel for the OIH graph</p>
<div class="section" id="simple-count">
<h3>Simple Count<a class="headerlink" href="#simple-count" title="Permalink to this headline">¶</a></h3>
<p>How many triples are there?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rq_count</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT (COUNT(*) as ?Triples) </span>
<span class="s2">WHERE </span>
<span class="s2">  {</span>
<span class="s2">      { ?s ?p ?o } </span>
<span class="s2">  }</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfsc</span> <span class="o">=</span> <span class="n">get_sparql_dataframe</span><span class="p">(</span><span class="n">oihdev</span><span class="p">,</span> <span class="n">rq_count</span><span class="p">)</span>
<span class="n">dfsc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Triples</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3004791</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="simple-org-list">
<h2>Simple org list<a class="headerlink" href="#simple-org-list" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rq_orgs</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT (COUNT(*) as ?Triples) </span>
<span class="s2">WHERE </span>
<span class="s2">  {</span>
<span class="s2">      { ?s ?p ?o } </span>
<span class="s2">  }</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfsc</span> <span class="o">=</span> <span class="n">get_sparql_dataframe</span><span class="p">(</span><span class="n">oihdev</span><span class="p">,</span> <span class="n">rq_orgs</span><span class="p">)</span>
<span class="n">dfsc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Triples</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3004791</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="predicate-counts">
<h3>Predicate Counts<a class="headerlink" href="#predicate-counts" title="Permalink to this headline">¶</a></h3>
<p>This gives an overview of unique predicates that connect a subject to an object.  This gives us both an idea of the properties we are using on things and count of their usage.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rq_pcount</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT ?p (COUNT(?p) as ?pCount)</span>
<span class="s2">WHERE</span>
<span class="s2">{</span>
<span class="s2">  ?s ?p ?o .</span>
<span class="s2">}</span>
<span class="s2">GROUP BY ?p</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfc</span> <span class="o">=</span> <span class="n">get_sparql_dataframe</span><span class="p">(</span><span class="n">oihdev</span><span class="p">,</span> <span class="n">rq_pcount</span><span class="p">)</span>
<span class="n">dfc</span><span class="p">[</span><span class="s1">&#39;pCount&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfc</span><span class="p">[</span><span class="s2">&quot;pCount&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># convert count to int</span>
<span class="c1"># dfc.set_index(&#39;p&#39;, inplace=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfc_sorted</span> <span class="o">=</span> <span class="n">dfc</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;pCount&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">dfc_sorted</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p</th>
      <th>pCount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>56</th>
      <td>http://www.w3.org/1999/02/22-rdf-syntax-ns#type</td>
      <td>717060</td>
    </tr>
    <tr>
      <th>8</th>
      <td>https://schema.org/keywords</td>
      <td>398084</td>
    </tr>
    <tr>
      <th>2</th>
      <td>https://schema.org/name</td>
      <td>336036</td>
    </tr>
    <tr>
      <th>4</th>
      <td>https://schema.org/url</td>
      <td>181943</td>
    </tr>
    <tr>
      <th>5</th>
      <td>https://schema.org/author</td>
      <td>157359</td>
    </tr>
    <tr>
      <th>0</th>
      <td>https://schema.org/description</td>
      <td>134582</td>
    </tr>
    <tr>
      <th>10</th>
      <td>https://schema.org/itemListElement</td>
      <td>79652</td>
    </tr>
    <tr>
      <th>1</th>
      <td>https://schema.org/identifier</td>
      <td>78923</td>
    </tr>
    <tr>
      <th>48</th>
      <td>https://schema.org/knowsAbout</td>
      <td>67752</td>
    </tr>
    <tr>
      <th>19</th>
      <td>http://www.w3.org/ns/prov#value</td>
      <td>66670</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rcount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfc_sorted</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rcount</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>58
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">dfc_sorted</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">38</span><span class="p">)[</span><span class="s1">&#39;pCount&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>357165
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hs</span> <span class="o">=</span> <span class="n">dfc_sorted</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">hs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="s1">&#39;Other&#39;</span><span class="p">,</span><span class="s1">&#39;pCount&#39;</span><span class="p">:</span><span class="n">ts</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
<span class="n">hs</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">hs</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pCount</th>
    </tr>
    <tr>
      <th>p</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>http://www.w3.org/1999/02/22-rdf-syntax-ns#type</th>
      <td>717060</td>
    </tr>
    <tr>
      <th>https://schema.org/keywords</th>
      <td>398084</td>
    </tr>
    <tr>
      <th>https://schema.org/name</th>
      <td>336036</td>
    </tr>
    <tr>
      <th>https://schema.org/url</th>
      <td>181943</td>
    </tr>
    <tr>
      <th>https://schema.org/author</th>
      <td>157359</td>
    </tr>
    <tr>
      <th>https://schema.org/description</th>
      <td>134582</td>
    </tr>
    <tr>
      <th>https://schema.org/itemListElement</th>
      <td>79652</td>
    </tr>
    <tr>
      <th>https://schema.org/identifier</th>
      <td>78923</td>
    </tr>
    <tr>
      <th>https://schema.org/knowsAbout</th>
      <td>67752</td>
    </tr>
    <tr>
      <th>http://www.w3.org/ns/prov#value</th>
      <td>66670</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;pCount&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/OIH_Queries_20_0.png" src="../../_images/OIH_Queries_20_0.png" />
</div>
</div>
</div>
<div class="section" id="oih-base-query">
<h3>OIH Base Query<a class="headerlink" href="#oih-base-query" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rq_main</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;prefix prov: &lt;http://www.w3.org/ns/prov#&gt;</span>
<span class="s2">        PREFIX con: &lt;http://www.ontotext.com/connectors/lucene#&gt;</span>
<span class="s2">        PREFIX luc: &lt;http://www.ontotext.com/owlim/lucene#&gt;</span>
<span class="s2">        PREFIX con-inst: &lt;http://www.ontotext.com/connectors/lucene/instance#&gt;</span>
<span class="s2">        PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span>
<span class="s2">        PREFIX schema: &lt;https://schema.org/&gt;</span>
<span class="s2">        PREFIX schemaold: &lt;http://schema.org/&gt;</span>
<span class="s2">        PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>

<span class="s2">        SELECT DISTINCT ?g  ?s   ?type ?score ?name ?url ?lit ?description ?headline</span>
<span class="s2">        WHERE</span>
<span class="s2">        {</span>
<span class="s2">           ?lit bds:search &quot;coral&quot; .</span>
<span class="s2">           ?lit bds:matchAllTerms &quot;false&quot; .</span>
<span class="s2">           ?lit bds:relevance ?score .</span>
<span class="s2">           graph ?g {</span>
<span class="s2">            ?s ?p ?lit .</span>
<span class="s2">            ?s rdf:type ?type . </span>
<span class="s2">            OPTIONAL { ?s schema:name ?name .   }</span>
<span class="s2">            OPTIONAL { ?s schema:headline ?headline .   }</span>
<span class="s2">            OPTIONAL { ?s schema:url ?url .   }</span>
<span class="s2">            OPTIONAL { ?s schema:description ?description .    }</span>
<span class="s2">          }</span>

<span class="s2">        }</span>
<span class="s2">        ORDER BY DESC(?score)</span>
<span class="s2">        LIMIT 30</span>
<span class="s2">        OFFSET 0</span>
<span class="s2">        &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">get_sparql_dataframe</span><span class="p">(</span><span class="n">oihdev</span><span class="p">,</span> <span class="n">rq_main</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>g</th>
      <th>s</th>
      <th>type</th>
      <th>score</th>
      <th>name</th>
      <th>url</th>
      <th>lit</th>
      <th>description</th>
      <th>headline</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>urn:gleaner:summoned:aquadocs:5d5193e7e253bbb1...</td>
      <td>oai:aquadocs.org:1834/8522</td>
      <td>https://schema.org/CreativeWork</td>
      <td>1.0</td>
      <td>Registro del coral de piedra Desmophyllum dian...</td>
      <td>https://www.oceandocs.org/handle/1834/8522</td>
      <td>Coral</td>
      <td>- In this note the first finding of stone cor...</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>urn:gleaner:summoned:aquadocs:5d5193e7e253bbb1...</td>
      <td>oai:aquadocs.org:1834/8922</td>
      <td>https://schema.org/CreativeWork</td>
      <td>1.0</td>
      <td>Promising marine species for hatchery.</td>
      <td>https://www.oceandocs.org/handle/1834/8922</td>
      <td>Coral</td>
      <td>- Published -</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>urn:gleaner:summoned:aquadocs:5d5193e7e253bbb1...</td>
      <td>oai:aquadocs.org:1834/3517</td>
      <td>https://schema.org/CreativeWork</td>
      <td>1.0</td>
      <td>Abundance of the excavating sponge Cliona deli...</td>
      <td>https://www.oceandocs.org/handle/1834/3517</td>
      <td>Coral</td>
      <td>- It is known that the encrusting and excavat...</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>urn:gleaner:summoned:aquadocs:5d5193e7e253bbb1...</td>
      <td>oai:aquadocs.org:1834/3268</td>
      <td>https://schema.org/CreativeWork</td>
      <td>1.0</td>
      <td>La existencia del coral Stephanocyathus nobili...</td>
      <td>https://www.oceandocs.org/handle/1834/3268</td>
      <td>Coral</td>
      <td>- El coral Stephanocyathus nobilis (Moseley) ...</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>urn:gleaner:summoned:aquadocs:5d5193e7e253bbb1...</td>
      <td>oai:aquadocs.org:1834/3299</td>
      <td>https://schema.org/CreativeWork</td>
      <td>1.0</td>
      <td>Uber ein holozÃ¤nes Korallen- und Mangrovenvor...</td>
      <td>https://www.oceandocs.org/handle/1834/3299</td>
      <td>Coral</td>
      <td>- En el mes de nov./1969 olas larga procedent...</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="oih-gleaner-query">
<h3>OIH Gleaner Query<a class="headerlink" href="#oih-gleaner-query" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rq_maingl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;prefix prov: &lt;http://www.w3.org/ns/prov#&gt;</span>
<span class="s2">        PREFIX con: &lt;http://www.ontotext.com/connectors/lucene#&gt;</span>
<span class="s2">        PREFIX luc: &lt;http://www.ontotext.com/owlim/lucene#&gt;</span>
<span class="s2">        PREFIX con-inst: &lt;http://www.ontotext.com/connectors/lucene/instance#&gt;</span>
<span class="s2">        PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span>
<span class="s2">        PREFIX schema: &lt;https://schema.org/&gt;</span>
<span class="s2">        PREFIX schemaold: &lt;http://schema.org/&gt;</span>
<span class="s2">        PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>

<span class="s2">        SELECT DISTINCT ?g  ?s  ?wat ?orgname ?domain ?type ?score ?name ?url ?lit ?description ?headline</span>
<span class="s2">        WHERE</span>
<span class="s2">        {</span>
<span class="s2">           ?lit bds:search &quot;coral&quot; .</span>
<span class="s2">           ?lit bds:matchAllTerms &quot;false&quot; .</span>
<span class="s2">           ?lit bds:relevance ?score .</span>
<span class="s2">           graph ?g {</span>
<span class="s2">            ?s ?p ?lit .</span>
<span class="s2">            ?s rdf:type ?type . </span>
<span class="s2">            OPTIONAL { ?s schema:name ?name .   }</span>
<span class="s2">            OPTIONAL { ?s schema:headline ?headline .   }</span>
<span class="s2">            OPTIONAL { ?s schema:url ?url .   }</span>
<span class="s2">            OPTIONAL { ?s schema:description ?description .    }</span>
<span class="s2">          }</span>
<span class="s2">           ?sp prov:generated ?g  .</span>
<span class="s2">           ?sp prov:used ?used .</span>
<span class="s2">           ?used prov:hadMember ?hm .</span>
<span class="s2">           ?hm prov:wasAttributedTo ?wat .</span>
<span class="s2">           ?wat rdf:name ?orgname .</span>
<span class="s2">           ?wat rdfs:seeAlso ?domain</span>
<span class="s2">        }</span>
<span class="s2">        ORDER BY DESC(?score)</span>
<span class="s2">        LIMIT 30</span>
<span class="s2">        OFFSET 0</span>
<span class="s2">        &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">get_sparql_dataframe</span><span class="p">(</span><span class="n">oihdev</span><span class="p">,</span> <span class="n">rq_maingl</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>g</th>
      <th>s</th>
      <th>wat</th>
      <th>orgname</th>
      <th>domain</th>
      <th>type</th>
      <th>score</th>
      <th>name</th>
      <th>url</th>
      <th>lit</th>
      <th>description</th>
      <th>headline</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>urn:gleaner:summoned:aquadocs:5d5193e7e253bbb1...</td>
      <td>oai:aquadocs.org:1834/35000</td>
      <td>https://www.re3data.org/repository/aquadocs</td>
      <td>AquaDocs</td>
      <td>https://aquadocs.org</td>
      <td>https://schema.org/CreativeWork</td>
      <td>1.0</td>
      <td>Promising marine species for hatchery</td>
      <td>https://www.oceandocs.org/handle/1834/35000</td>
      <td>Coral</td>
      <td></td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>urn:gleaner:summoned:aquadocs:5d5193e7e253bbb1...</td>
      <td>oai:aquadocs.org:1834/2013</td>
      <td>https://www.re3data.org/repository/aquadocs</td>
      <td>AquaDocs</td>
      <td>https://aquadocs.org</td>
      <td>https://schema.org/CreativeWork</td>
      <td>1.0</td>
      <td>Interacciones entre corales y macroalgas: depe...</td>
      <td>https://www.oceandocs.org/handle/1834/2013</td>
      <td>Coral</td>
      <td>- Macroalgae proliferation on coral reefs has...</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>urn:gleaner:summoned:aquadocs:5d5193e7e253bbb1...</td>
      <td>oai:aquadocs.org:1834/20117</td>
      <td>https://www.re3data.org/repository/aquadocs</td>
      <td>AquaDocs</td>
      <td>https://aquadocs.org</td>
      <td>https://schema.org/CreativeWork</td>
      <td>1.0</td>
      <td>M/V CONNECTED Coral Reef Restoration Monitorin...</td>
      <td>https://www.oceandocs.org/handle/1834/20117</td>
      <td>Coral</td>
      <td>- This document presents the results of the m...</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>urn:gleaner:summoned:aquadocs:5d5193e7e253bbb1...</td>
      <td>oai:aquadocs.org:1834/3262</td>
      <td>https://www.re3data.org/repository/aquadocs</td>
      <td>AquaDocs</td>
      <td>https://aquadocs.org</td>
      <td>https://schema.org/CreativeWork</td>
      <td>1.0</td>
      <td>Los corales (Anthozoa e Hidrozoa) de la bahÃ­a...</td>
      <td>https://www.oceandocs.org/handle/1834/3262</td>
      <td>Coral</td>
      <td>- En el presente trabajo se describe las form...</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>urn:gleaner:summoned:aquadocs:5d5193e7e253bbb1...</td>
      <td>oai:aquadocs.org:1834/7130</td>
      <td>https://www.re3data.org/repository/aquadocs</td>
      <td>AquaDocs</td>
      <td>https://aquadocs.org</td>
      <td>https://schema.org/CreativeWork</td>
      <td>1.0</td>
      <td>Informe TÃ©cnico AMERB NÂº 087/2014. EvaluaciÃ...</td>
      <td>https://www.oceandocs.org/handle/1834/7130</td>
      <td>Coral</td>
      <td>- Los informes tÃ©cnicos son la respuesta adm...</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="query-for-prov">
<h2>Query for prov<a class="headerlink" href="#query-for-prov" title="Permalink to this headline">¶</a></h2>
<p>Count (count(distinct ?tag) as ?count)</p>
<p>Need to look for the date in the prov record too.  I keep it by day granularity, so I should be able to see the difference if I focos on a specific repo or look over the dates</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rq_prov</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;prefix prov: &lt;http://www.w3.org/ns/prov#&gt;</span>
<span class="s2">        PREFIX con: &lt;http://www.ontotext.com/connectors/lucene#&gt;</span>
<span class="s2">        PREFIX luc: &lt;http://www.ontotext.com/owlim/lucene#&gt;</span>
<span class="s2">        PREFIX con-inst: &lt;http://www.ontotext.com/connectors/lucene/instance#&gt;</span>
<span class="s2">        PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span>
<span class="s2">        PREFIX schema: &lt;https://schema.org/&gt;</span>
<span class="s2">        PREFIX schemaold: &lt;http://schema.org/&gt;</span>
<span class="s2">        PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>

<span class="s2">       SELECT   ( COUNT(?hm) as ?count) ?wat  ?orgname ?domain</span>
<span class="s2">        WHERE</span>
<span class="s2">        {</span>
<span class="s2">           ?hm prov:wasAttributedTo ?wat .</span>
<span class="s2">           ?wat rdf:name ?orgname .</span>
<span class="s2">           ?wat rdfs:seeAlso ?domain</span>
<span class="s2">        }</span>
<span class="s2">        GROUP BY ?wat ?orgname ?domain</span>
<span class="s2">        &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rq_prov2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;prefix prov: &lt;http://www.w3.org/ns/prov#&gt;</span>
<span class="s2">        PREFIX con: &lt;http://www.ontotext.com/connectors/lucene#&gt;</span>
<span class="s2">        PREFIX luc: &lt;http://www.ontotext.com/owlim/lucene#&gt;</span>
<span class="s2">        PREFIX con-inst: &lt;http://www.ontotext.com/connectors/lucene/instance#&gt;</span>
<span class="s2">        PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span>
<span class="s2">        PREFIX schema: &lt;https://schema.org/&gt;</span>
<span class="s2">        PREFIX schemaold: &lt;http://schema.org/&gt;</span>
<span class="s2">        PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>

<span class="s2">        SELECT ( COUNT(?s) as ?count) ?wat  ?orgname ?domain</span>
<span class="s2">        WHERE</span>
<span class="s2">        {</span>
<span class="s2">           graph ?g {</span>
<span class="s2">             VALUES (?type) { ( schema:CreativeWork ) ( schema:Map )  ( schema:Person )  ( schema:Organization )  ( schema:Dataset )  ( schema:Course ) } </span>
<span class="s2">            ?s rdf:type ?type . </span>
<span class="s2">            OPTIONAL { ?s schema:name ?name .   }</span>
<span class="s2">            OPTIONAL { ?s schema:headline ?headline .   }</span>
<span class="s2">            OPTIONAL { ?s schema:url ?url .   }</span>
<span class="s2">            OPTIONAL { ?s schema:description ?description .    }</span>
<span class="s2">          }</span>
<span class="s2">           ?sp prov:generated ?g  .</span>
<span class="s2">           ?sp prov:used ?used .</span>
<span class="s2">           ?used prov:hadMember ?hm .</span>
<span class="s2">           ?hm prov:wasAttributedTo ?wat .</span>
<span class="s2">           ?wat rdf:name ?orgname .</span>
<span class="s2">           ?wat rdfs:seeAlso ?domain</span>
<span class="s2">        }</span>
<span class="s2">                GROUP BY ?wat ?orgname ?domain</span>

<span class="s2">        &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfp</span> <span class="o">=</span> <span class="n">get_sparql_dataframe</span><span class="p">(</span><span class="n">oihdev</span><span class="p">,</span> <span class="n">rq_prov2</span><span class="p">)</span>
<span class="n">dfp</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfp</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># convert count c to int</span>
<span class="n">dfp</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;orgname&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dfp</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>wat</th>
      <th>domain</th>
    </tr>
    <tr>
      <th>orgname</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Marine Training EU</th>
      <td>937</td>
      <td>https://www.re3data.org/repository/marinetraining</td>
      <td>https://marinetraining.eu/</td>
    </tr>
    <tr>
      <th>Ocean Biodiversity Information System</th>
      <td>9140</td>
      <td>https://www.re3data.org/repository/obis</td>
      <td>https://obis.org</td>
    </tr>
    <tr>
      <th>Ocean Best Practices</th>
      <td>8562</td>
      <td>https://www.re3data.org/repository/obps</td>
      <td>https://oih.oceanbestpractices.org</td>
    </tr>
    <tr>
      <th>AquaDocs</th>
      <td>75465</td>
      <td>https://www.re3data.org/repository/aquadocs</td>
      <td>https://aquadocs.org</td>
    </tr>
    <tr>
      <th>OceanExpert UNESCO/IOC Project Office for IODE</th>
      <td>44455</td>
      <td>https://www.re3data.org/repository/oceanexpert</td>
      <td>https://oceanexpert.org/</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">dfp</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/OIH_Queries_31_0.png" src="../../_images/OIH_Queries_31_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rq_provdate</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;prefix prov: &lt;http://www.w3.org/ns/prov#&gt;</span>
<span class="s2">        PREFIX con: &lt;http://www.ontotext.com/connectors/lucene#&gt;</span>
<span class="s2">        PREFIX luc: &lt;http://www.ontotext.com/owlim/lucene#&gt;</span>
<span class="s2">        PREFIX con-inst: &lt;http://www.ontotext.com/connectors/lucene/instance#&gt;</span>
<span class="s2">        PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span>
<span class="s2">        PREFIX schema: &lt;https://schema.org/&gt;</span>
<span class="s2">        PREFIX schemaold: &lt;http://schema.org/&gt;</span>
<span class="s2">        PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>

<span class="s2"> </span>
<span class="s2">       SELECT   ( COUNT(?s) as ?count) ?time ?orgname  </span>
<span class="s2">        WHERE</span>
<span class="s2">        {</span>
<span class="s2">           ?s a prov:Activity  .</span>
<span class="s2">           ?s prov:endedAtTime ?time .</span>
<span class="s2">           ?s prov:generated ?gen .</span>
<span class="s2">           ?s prov:used ?used .</span>
<span class="s2">           ?used prov:hadMember ?mem .</span>
<span class="s2">           ?mem prov:wasAttributedTo ?wat .</span>
<span class="s2">           ?wat rdf:name ?orgname .</span>
<span class="s2">           ?wat rdfs:seeAlso ?domain</span>
<span class="s2">        }</span>
<span class="s2">        GROUP BY ?time ?orgname  </span>
<span class="s2">        &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfpd</span> <span class="o">=</span> <span class="n">get_sparql_dataframe</span><span class="p">(</span><span class="n">oihdev</span><span class="p">,</span> <span class="n">rq_provdate</span><span class="p">)</span>
<span class="n">dfpd</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>time</th>
      <th>orgname</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>313</td>
      <td>2021-09-25T00:00:00.000Z</td>
      <td>Marine Training EU</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2021-09-25T00:00:00.000Z</td>
      <td>Ocean Best Practices</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4249</td>
      <td>2021-09-25T00:00:00.000Z</td>
      <td>Ocean Biodiversity Information System</td>
    </tr>
    <tr>
      <th>3</th>
      <td>28771</td>
      <td>2021-09-25T00:00:00.000Z</td>
      <td>OceanExpert UNESCO/IOC Project Office for IODE</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>2021-09-25T00:00:00.000Z</td>
      <td>AquaDocs</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfpd</span> <span class="o">=</span> <span class="n">get_sparql_dataframe</span><span class="p">(</span><span class="n">oihdev</span><span class="p">,</span> <span class="n">rq_provdate</span><span class="p">)</span>
<span class="n">dfpd</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfpd</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># convert count c to int</span>
<span class="n">dfpd</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dfpd</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>orgname</th>
    </tr>
    <tr>
      <th>time</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2021-09-25T00:00:00.000Z</th>
      <td>313</td>
      <td>Marine Training EU</td>
    </tr>
    <tr>
      <th>2021-09-25T00:00:00.000Z</th>
      <td>1</td>
      <td>Ocean Best Practices</td>
    </tr>
    <tr>
      <th>2021-09-25T00:00:00.000Z</th>
      <td>4249</td>
      <td>Ocean Biodiversity Information System</td>
    </tr>
    <tr>
      <th>2021-09-25T00:00:00.000Z</th>
      <td>28771</td>
      <td>OceanExpert UNESCO/IOC Project Office for IODE</td>
    </tr>
    <tr>
      <th>2021-09-25T00:00:00.000Z</th>
      <td>1</td>
      <td>AquaDocs</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">dfpd</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">rot</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/OIH_Queries_35_0.png" src="../../_images/OIH_Queries_35_0.png" />
</div>
</div>
</div>
<div class="section" id="feed-query">
<h2>Feed query<a class="headerlink" href="#feed-query" title="Permalink to this headline">¶</a></h2>
<p>Goal here is see if the prov will give us the elements for an RSS feed.<br />
The <a class="reference external" href="https://validator.w3.org/feed/docs/rss2.html">RSS specs</a> give us the elements we need to populate.  Focus on; title(name), date, author, description</p>
<ul class="simple">
<li><p>Element 	Description 	Example</p></li>
<li><p>title 	The title of the item. 	Venice Film Festival Tries to Quit Sinking</p></li>
<li><p>link 	The URL of the item. 	<a class="reference external" href="http://www.nytimes.com/2002/09/07/movies/07FEST.html">http://www.nytimes.com/2002/09/07/movies/07FEST.html</a></p></li>
<li><p>description 	The item synopsis. 	Some of the most heated chatter at the Venice Film Festival this week was about the way that the arrival of the stars at the Palazzo del Cinema was being staged.</p></li>
<li><p>author 	Email address of the author of the item. More. 	<a class="reference external" href="mailto:oprah&#37;&#52;&#48;oxygen&#46;net">oprah<span>&#64;</span>oxygen<span>&#46;</span>net</a></p></li>
<li><p>category 	Includes the item in one or more categories. More. 	Simpsons Characters</p></li>
<li><p>comments 	URL of a page for comments relating to the item. More. 	<a class="reference external" href="http://www.myblog.org/cgi-local/mt/mt-comments.cgi?entry_id=290">http://www.myblog.org/cgi-local/mt/mt-comments.cgi?entry_id=290</a></p></li>
<li><p>enclosure 	Describes a media object that is attached to the item. More. 	<enclosure url="http://live.curry.com/mp3/celebritySCms.mp3" length="1069871" type="audio/mpeg"/></p></li>
<li><p>guid 	A string that uniquely identifies the item. More. 	<guid isPermaLink="true"><a class="reference external" href="http://inessential.com/2002/09/01.php#a2">http://inessential.com/2002/09/01.php#a2</a></guid></p></li>
<li><p>pubDate 	Indicates when the item was published. More. 	Sun, 19 May 2002 15:21:36 GMT</p></li>
<li><p>source 	The RSS channel that the item came from. More. 	<source url="http://www.quotationspage.com/data/qotd.rss">Quotes of the Day</source></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rq_provdatelist</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;prefix prov: &lt;http://www.w3.org/ns/prov#&gt;</span>
<span class="s2">        PREFIX con: &lt;http://www.ontotext.com/connectors/lucene#&gt;</span>
<span class="s2">        PREFIX luc: &lt;http://www.ontotext.com/owlim/lucene#&gt;</span>
<span class="s2">        PREFIX con-inst: &lt;http://www.ontotext.com/connectors/lucene/instance#&gt;</span>
<span class="s2">        PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span>
<span class="s2">        PREFIX schema: &lt;https://schema.org/&gt;</span>
<span class="s2">        PREFIX schemaold: &lt;http://schema.org/&gt;</span>
<span class="s2">        PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>

<span class="s2">       SELECT  ?time ?orgname ?memval  ?memname ?memdesc</span>
<span class="s2">        WHERE</span>
<span class="s2">        {</span>
<span class="s2">           ?s a prov:Activity  .</span>
<span class="s2">           ?s prov:endedAtTime ?time .</span>
<span class="s2">           ?s prov:generated ?gen .</span>
<span class="s2">           ?s prov:used ?used .</span>
<span class="s2">           ?used prov:hadMember ?mem .</span>
<span class="s2">           ?mem prov:value ?memval .</span>
<span class="s2">           ?mem schema:name ?memname .</span>
<span class="s2">           ?mem schema:description ?memdesc .</span>
<span class="s2">           ?mem prov:wasAttributedTo ?wat .</span>
<span class="s2">           ?wat rdf:name ?orgname .</span>
<span class="s2">           ?wat rdfs:seeAlso ?domain</span>
<span class="s2">        }</span>
<span class="s2">        ORDER BY DESC(?time)</span>
<span class="s2">        LIMIT 1000</span>

<span class="s2">        &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfpl</span> <span class="o">=</span> <span class="n">get_sparql_dataframe</span><span class="p">(</span><span class="n">oihdev</span><span class="p">,</span> <span class="n">rq_provdatelist</span><span class="p">)</span>
<span class="n">dfpl</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>orgname</th>
      <th>memval</th>
      <th>memname</th>
      <th>memdesc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2021-09-25T00:00:00.000Z</td>
      <td>Marine Training EU</td>
      <td>https://www.marinetraining.eu/node/4349</td>
      <td>Shipping and Offshore Activities in the Arctic</td>
      <td>Course Description:\n\nThe reduction of Arctic...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2021-09-25T00:00:00.000Z</td>
      <td>Marine Training EU</td>
      <td>https://www.marinetraining.eu/node/4389</td>
      <td>Methods of Scientific Research</td>
      <td>Course Description:\n\nThe course covers the p...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2021-09-25T00:00:00.000Z</td>
      <td>Marine Training EU</td>
      <td>https://www.marinetraining.eu/node/4159</td>
      <td>Diseases and Veterinary Aspects Related to Aqu...</td>
      <td>General course objectives\n\nThe student will ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2021-09-25T00:00:00.000Z</td>
      <td>Marine Training EU</td>
      <td>https://www.marinetraining.eu/node/3908</td>
      <td>Navigation Technology</td>
      <td>Course content\n\nRadio technology\n\n\n\tAnte...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2021-09-25T00:00:00.000Z</td>
      <td>Marine Training EU</td>
      <td>https://www.marinetraining.eu/node/4345</td>
      <td>Qualitative Research Methods</td>
      <td>Course Description:\n\nThe course is designed ...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2021-09-25T00:00:00.000Z</td>
      <td>Marine Training EU</td>
      <td>https://www.marinetraining.eu/node/4330</td>
      <td>Icelandic Society and Environment</td>
      <td>Course Description:\n\nThe course explores the...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2021-09-25T00:00:00.000Z</td>
      <td>Marine Training EU</td>
      <td>https://www.marinetraining.eu/node/4323</td>
      <td>Fisheries in Iceland</td>
      <td>Course Description:\n\nIn this course the lear...</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2021-09-25T00:00:00.000Z</td>
      <td>Marine Training EU</td>
      <td>https://www.marinetraining.eu/node/3877</td>
      <td>Basal and Comparative Immunology</td>
      <td>Course content\n\nThis course aims to provide ...</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2021-09-25T00:00:00.000Z</td>
      <td>Marine Training EU</td>
      <td>https://www.marinetraining.eu/node/3958</td>
      <td>Evolutionary Genetics</td>
      <td>Evolution is one of the central, unifying theo...</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2021-09-25T00:00:00.000Z</td>
      <td>Marine Training EU</td>
      <td>https://www.marinetraining.eu/node/4326</td>
      <td>Physical Processes of Coastal Environments</td>
      <td>Course Description:\n\nThe course focuses on o...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="types-breakdown">
<h2>Types Breakdown<a class="headerlink" href="#types-breakdown" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rq_types</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;prefix prov: &lt;http://www.w3.org/ns/prov#&gt;</span>
<span class="s2">        PREFIX con: &lt;http://www.ontotext.com/connectors/lucene#&gt;</span>
<span class="s2">        PREFIX luc: &lt;http://www.ontotext.com/owlim/lucene#&gt;</span>
<span class="s2">        PREFIX con-inst: &lt;http://www.ontotext.com/connectors/lucene/instance#&gt;</span>
<span class="s2">        PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span>
<span class="s2">        PREFIX schema: &lt;https://schema.org/&gt;</span>
<span class="s2">        PREFIX schemaold: &lt;http://schema.org/&gt;</span>
<span class="s2">        PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>

<span class="s2"> </span>
<span class="s2">       SELECT   ( COUNT(?type) as ?count) ?type   </span>
<span class="s2">        WHERE</span>
<span class="s2">        {</span>
<span class="s2">        </span>
<span class="s2">           ?s rdf:type ?type</span>
<span class="s2">           FILTER ( ?type IN (schema:ResearchProject, schema:Project, schema:Organization, schema:Dataset, schema:CreativeWork, schema:Person, schema:Map, schema:Course, schema:CourseInstance, schema:Event, schema:Vehicle) )</span>

<span class="s2">        }</span>
<span class="s2">        GROUP BY ?type  </span>
<span class="s2">        ORDER BY DESC(?count)</span>
<span class="s2">        &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dft</span> <span class="o">=</span> <span class="n">get_sparql_dataframe</span><span class="p">(</span><span class="n">oihdev</span><span class="p">,</span> <span class="n">rq_types</span><span class="p">)</span>
<span class="n">dft</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dft</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># convert count c to int</span>
<span class="n">dft</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dft</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ipykernel_2082200</span><span class="o">/</span><span class="mf">831059564.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">dft</span> <span class="o">=</span> <span class="n">get_sparql_dataframe</span><span class="p">(</span><span class="n">oihdev</span><span class="p">,</span> <span class="n">rq_types</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">dft</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dft</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># convert count c to int</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">dft</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">dft</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;rq_types&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_t</span> <span class="o">=</span> <span class="n">dft</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/OIH_Queries_42_0.png" src="../../_images/OIH_Queries_42_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rq_typesCHECK</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;prefix prov: &lt;http://www.w3.org/ns/prov#&gt;</span>
<span class="s2">        PREFIX con: &lt;http://www.ontotext.com/connectors/lucene#&gt;</span>
<span class="s2">        PREFIX luc: &lt;http://www.ontotext.com/owlim/lucene#&gt;</span>
<span class="s2">        PREFIX con-inst: &lt;http://www.ontotext.com/connectors/lucene/instance#&gt;</span>
<span class="s2">        PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span>
<span class="s2">        PREFIX schema: &lt;https://schema.org/&gt;</span>
<span class="s2">        PREFIX schemaold: &lt;http://schema.org/&gt;</span>
<span class="s2">        PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>

<span class="s2"> </span>
<span class="s2">       SELECT  ( COUNT(?type) as ?count) ?type   </span>
<span class="s2">        WHERE</span>
<span class="s2">         {</span>
<span class="s2">           graph ?g {</span>
<span class="s2">            ?s ?p ?lit .</span>
<span class="s2">            ?s rdf:type ?type . </span>
<span class="s2">            OPTIONAL { ?s schema:name ?name .   }</span>
<span class="s2">            OPTIONAL { ?s schema:headline ?headline .   }</span>
<span class="s2">            OPTIONAL { ?s schema:url ?url .   }</span>
<span class="s2">            OPTIONAL { ?s schema:description ?description .    }</span>
<span class="s2">          }</span>
<span class="s2">           ?sp prov:generated ?g  .</span>
<span class="s2">           ?sp prov:used ?used .</span>
<span class="s2">           ?used prov:hadMember ?hm .</span>
<span class="s2">           ?hm prov:wasAttributedTo ?wat .</span>
<span class="s2">           ?wat rdf:name &quot;Ocean Biodiversity Information System&quot; .</span>
<span class="s2">        }</span>
<span class="s2">        GROUP BY ?type  </span>
<span class="s2">         ORDER BY DESC(?count)</span>
<span class="s2">   </span>
<span class="s2">        &quot;&quot;&quot;</span>

<span class="c1">#      GROUP BY ?type  </span>
<span class="c1">#         ORDER BY DESC(?count)</span>

<span class="c1">#  ( COUNT(?type) as ?count) ?type   </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dft</span> <span class="o">=</span> <span class="n">get_sparql_dataframe</span><span class="p">(</span><span class="n">oihdev</span><span class="p">,</span> <span class="n">rq_typesCHECK</span><span class="p">)</span>
<span class="c1"># dft[&#39;count&#39;] = dft[&quot;count&quot;].astype(int) # convert count c to int</span>
<span class="c1"># dft.set_index(&#39;type&#39;, inplace=True)</span>
<span class="n">dft</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>73093</td>
      <td>https://schema.org/Dataset</td>
    </tr>
    <tr>
      <th>1</th>
      <td>19568</td>
      <td>https://schema.org/Organization</td>
    </tr>
    <tr>
      <th>2</th>
      <td>13640</td>
      <td>https://schema.org/PropertyValue</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12414</td>
      <td>https://schema.org/DataDownload</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10932</td>
      <td>https://schema.org/Place</td>
    </tr>
    <tr>
      <th>5</th>
      <td>8496</td>
      <td>https://schema.org/DataCatalog</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7288</td>
      <td>https://schema.org/GeoShape</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="check-status-of-spatial-predicates">
<h2>Check status of spatial predicates<a class="headerlink" href="#check-status-of-spatial-predicates" title="Permalink to this headline">¶</a></h2>
<p>We have 3500+ items with spatial data using the <a class="reference external" href="http://scheme.org">scheme.org</a> vocabulary.   No current data published using the geosparql WKT patterns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rq_wktcount</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT (COUNT(?s) as ?sCount)</span>
<span class="s2">WHERE</span>
<span class="s2">{</span>
<span class="s2">  {</span>
<span class="s2">  ?s &lt;http://www.opengis.net/ont/geosparql#hasGeometry&gt; ?o .</span>
<span class="s2">}</span>
<span class="s2">UNION</span>
<span class="s2">{</span>
<span class="s2">  ?s &lt;https://schema.org/spatialCoverage&gt; ?o</span>
<span class="s2">  }</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfwc</span> <span class="o">=</span> <span class="n">get_sparql_dataframe</span><span class="p">(</span><span class="n">oihdev</span><span class="p">,</span> <span class="n">rq_wktcount</span><span class="p">)</span>
<span class="n">dfwc</span><span class="p">[</span><span class="s1">&#39;sCount&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfwc</span><span class="p">[</span><span class="s2">&quot;sCount&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># convert count to int</span>
<span class="c1"># dfc.set_index(&#39;p&#39;, inplace=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfwc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sCount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3644</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./tooling/notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="OIH_IndexIntro.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Indexing Concepts</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="OIH_Editor.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">OIH Editing Playground</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By IODEPO<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>